<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.questory.repository.QuestRepository">

    <select id="saveQuest">
        INSERT INTO Quests (
            attraction_id,
            member_email,
            title,
            quest_description,
            difficulty,
            created_at,
            is_private,
            content_type_id,
            stamp_description
        ) VALUES (
            #{questRequestDto.attractionId},
            #{memberEmail},
            #{questRequestDto.title},
            #{questRequestDto.questDescription},
            #{questRequestDto.difficulty},
            CURRENT_DATE(),
            #{questRequestDto.isPrivate},
            #{contentTypeId},
            #{questRequestDto.stampDescription}
        )
    </select>

    <select id="getAttractionById">
        SELECT count(*) FROM attractions WHERE no=#{attractionId};
    </select>

    <select id="getContentTypeIdByAttractionId">
        SELECT content_type_id FROM attractions WHERE no=#{attractionId};
    </select>

    <select id="modifyQuest">
        UPDATE quests
        SET
        title = #{questRequestDto.title},
        quest_description= #{questRequestDto.questDescription},
        difficulty = #{questRequestDto.difficulty},
        created_at = CURRENT_DATE(),
        is_private = #{questRequestDto.isPrivate},
        stamp_description =  #{questRequestDto.stampDescription}
        WHERE
        location_quest_id = #{questId};
    </select>

    <select id="getmemberEmailByQuestId">
        SELECT member_email FROM quests WHERE location_quest_id=#{questId};
    </select>

    <select id="deleteQuest">
        UPDATE quests
        SET
            is_deleted = 1
        WHERE
            location_quest_id = #{questId};
    </select>

    <select id="getQuestCntByQuestId">
        SELECT count(*)
        FROM quests
        WHERE location_quest_id = #{questId};
    </select>

    <select id="getValidQuestCntByQuestId">
        SELECT count(*)
        FROM quests
        WHERE location_quest_id = #{questId} AND is_deleted = 0;
    </select>

</mapper>