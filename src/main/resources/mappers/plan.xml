<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.questory.repository.PlanRepository">
    <select id="findByMemberEmail" parameterType="string" resultType="com.ssafy.questory.domain.Plan">
        SELECT
        plan_id AS planId,
        member_email AS memberEmail,
        title,
        description,
        start_date AS startDate,
        end_date AS endDate,
        created_at AS createdAt,
        is_start AS isStart,
        is_shared AS isShared
        FROM Plans
        WHERE member_email = #{memberEmail}
    </select>
    <insert id="create" parameterType="com.ssafy.questory.domain.Plan" useGeneratedKeys="true" keyProperty="planId">
        INSERT INTO Plans (member_email, title, description, start_date, end_date, created_at, is_start)
        VALUES (#{memberEmail}, #{title}, #{description}, #{startDate}, #{endDate}, NOW(), 0)
    </insert>
    <update id="update" parameterType="com.ssafy.questory.domain.Plan">
        UPDATE Plans
        SET title = #{title},
        description = #{description},
        start_date = #{startDate},
        end_date = #{endDate}
        WHERE plan_id = #{planId}
    </update>
    <select id="findById" parameterType="long" resultMap="planResultMap">
        SELECT * FROM Plans WHERE plan_id = #{planId}
    </select>
    <resultMap id="planResultMap" type="com.ssafy.questory.domain.Plan">
        <id property="planId" column="plan_id"/>
        <result property="memberEmail" column="member_email"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="createdAt" column="created_at"/>
        <result property="isStart" column="is_start"/>
        <result property="isShared" column="is_shared"/>
    </resultMap>
    <delete id="deleteById" parameterType="long">
        DELETE FROM Plans WHERE plan_id = #{planId}
    </delete>
    <update id="toggleShareStatus">
        UPDATE plans
        SET is_shared = #{shared}
        WHERE plan_id = #{planId}
    </update>
</mapper>
